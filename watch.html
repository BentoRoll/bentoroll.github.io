<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch - BentoRoll</title>
<link rel="stylesheet" href="/src/styles/reset.css">
<link rel="stylesheet" href="/src/styles/header.css">
<link rel="stylesheet" href="/src/styles/hero.css">
<link rel="stylesheet" href="/src/styles/cards.css">
<link rel="stylesheet" href="/src/styles/episodes.css">
<link rel="stylesheet" href="/src/styles/pages.css">
<link rel="stylesheet" href="/src/styles/watch.css">
<link rel="stylesheet" href="/src/styles/labels.css">
<link rel="stylesheet" href="/src/styles/responsive.css">
<link rel="stylesheet" href="/src/styles/navbar.css"> <!-- navbar now fully modular -->
<link rel="icon" type="image/x-icon" href="https://i.ibb.co/pjJPbymj/image.png">
<style>
.video-fade-out {
    opacity: 0;
    transition: opacity 0.3s ease;
}
.version-button {
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
    border: none;
    cursor: pointer;
    margin-right: 8px;
    color: #fff;
    text-transform: uppercase;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    transition: transform 0.2s, box-shadow 0.2s;
}
.version-button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.25);
}
.version-button:active {
    transform: translateY(0) scale(0.98);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}
.version-button.en { background-color: #f60; }
.version-button.ja { background-color: #007aff; }
.version-button.ko { background-color: #28a745; }
.version-button.active { box-shadow: 0 6px 15px rgba(0,0,0,0.4); }
</style>
</head>
<body>
<header>
    <div id="logo-container">
        <img id="logo-img" src="https://i.ibb.co/pjJPbymj/image.png" alt="BentoRoll Logo">
        <h1 id="logo-text">BentoRoll</h1>
    </div>
    <nav>
        <a href="index.html">Home</a>
    </nav>
</header>

<main class="watch-page">
    <div class="watch-container">
        <video id="introVideo" autoplay playsinline class="video-player">
            <source src="https://github.com/Vystelior/bentoroll.github.io/raw/refs/heads/main/src/intro.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <iframe id="player" class="video-player" frameborder="0" allowfullscreen style="display:none;"></iframe>
    </div>
    
    <section class="episode-details">
        <h2 id="episode-title" class="watch-title">Loading...</h2>
        <p id="episode-description" class="episode-description-preview"></p>

        <div class="episode-version-buttons" id="version-buttons"></div>

        <div class="episode-nav-buttons">
            <button id="prev-btn" class="nav-button prev-button" disabled>&larr; Previous</button>
            <button id="next-btn" class="nav-button next-button" disabled>Next &rarr;</button>
        </div>
    </section>
</main>

<footer>
    <p>&copy; 2025 BentoRoll. All rights not reserved.</p>
</footer>

<script>
const params = new URLSearchParams(window.location.search);
const epNumStr = params.get('episode');
const epNum = parseInt(epNumStr);
const seriesSlug = params.get('series') || "gachiakuta";
const seasonNum = parseInt(params.get('season')) || 1;
let version = params.get('version') || 'en';

const episodeTitle = document.getElementById('episode-title');
const episodeDesc = document.getElementById('episode-description');
const player = document.getElementById('player');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const versionButtons = document.getElementById('version-buttons');
const intro = document.getElementById('introVideo');

const capitalize = s => typeof s === 'string' ? s.charAt(0).toUpperCase() + s.slice(1) : '';
const navigateToEpisode = (num, ver = version) => {
    window.location.href = `watch.html?series=${seriesSlug}&season=${seasonNum}&episode=${num}&version=${ver}`;
};

const showEpisode = (videoUrl) => {
    intro.classList.add('video-fade-out');
    setTimeout(() => {
        intro.remove();
        player.style.display = 'block';
        player.src = videoUrl;
        player.allow = "autoplay; fullscreen";
    }, 300);
};

fetch(`data/${seriesSlug}/season${seasonNum}.json`)
.then(res => res.json())
.then(episodes => {
    episodes.sort((a,b) => a.episode - b.episode);
    const currentIndex = episodes.findIndex(e => e.episode === epNum);
    const ep = episodes[currentIndex];

    if (ep) {
        let videoUrl = ep.videos?.[version] || "#";
        if (videoUrl.includes("streamtape") || videoUrl.includes("stape.fun"))
            videoUrl = videoUrl.split("?")[0] + "?autoplay=1";

        episodeTitle.textContent = `${capitalize(seriesSlug)} S${seasonNum}E${ep.episode}: ${ep.title}`;
        episodeDesc.textContent = ep.description || "No description available.";
        document.title = `${capitalize(seriesSlug)} S${seasonNum}E${ep.episode} | BentoRoll`;

        versionButtons.innerHTML = '';
        Object.keys(ep.videos).forEach(lang => {
            const btn = document.createElement('button');
            btn.textContent = lang.toUpperCase();
            btn.className = `version-button ${lang}` + (lang === version ? ' active' : '');
            btn.onclick = () => navigateToEpisode(ep.episode, lang);
            versionButtons.appendChild(btn);
        });

        const prevEp = episodes[currentIndex - 1];
        const nextEp = episodes[currentIndex + 1];
        if (prevEp) {
            prevBtn.disabled = false;
            prevBtn.textContent = `← Ep ${prevEp.episode}`;
            prevBtn.onclick = () => navigateToEpisode(prevEp.episode, version);
        }
        if (nextEp) {
            nextBtn.disabled = false;
            nextBtn.textContent = `Ep ${nextEp.episode} →`;
            nextBtn.onclick = () => navigateToEpisode(nextEp.episode, version);
        }

        intro.onended = () => showEpisode(videoUrl);
        intro.onclick = () => showEpisode(videoUrl);
    } else {
        episodeTitle.textContent = `Episode ${epNum} not found in Season ${seasonNum}.`;
        episodeDesc.style.display = 'none';
        player.style.display = 'none';
    }
})
.catch(err => {
    console.error("Error loading:", err);
    episodeTitle.textContent = "Failed to load episode data.";
});
</script>


<!-- Import navbar.js for logo click -->
<script src="/src/scripts/navbar.js"></script>

</body>
</html>
